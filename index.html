<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>10円ゲーム 簡易物理シミュレーション</title>
  <style>
    body {
      margin: 0;
      background: #222;
      color: #eee;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    #world {
      flex: 1;
    }
    #ui {
      padding: 8px;
      background: #111;
      font-size: 14px;
    }
    button {
      margin-right: 8px;
    }
  </style>
</head>
<body>
  <div id="world"></div>
  <div id="ui">
    <button id="drop">10円を落とす</button>
    重力: <input id="gravity" type="number" step="0.1" value="1" style="width:60px;"> (下向き)
    <button id="reset">リセット</button>
  </div>

  <!-- Matter.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/matter-js@0.20.0/build/matter.min.js"></script>
  <script>
    // エイリアス
    const Engine = Matter.Engine;
    const Render = Matter.Render;
    const Runner = Matter.Runner;
    const Bodies = Matter.Bodies;
    const Composite = Matter.Composite;
    const Body = Matter.Body;

    // エンジン・レンダラー作成
    const engine = Engine.create();
    const world  = engine.world;

    // 重力（Y方向）
    engine.world.gravity.y = 1.0; // UI から後で変えられる

    const width  = 400;
    const height = 600;

    const render = Render.create({
      element: document.getElementById('world'),
      engine: engine,
      options: {
        width: width,
        height: height,
        wireframes: false,
        background: '#222'
      }
    });

    Render.run(render);
    const runner = Runner.create();
    Runner.run(runner, engine);

    // 縦の箱（左右と下を壁にする）
    const thickness = 30;

    const leftWall = Bodies.rectangle(50, height/2, thickness, height, {
      isStatic: true,
      render: { fillStyle: '#555' }
    });
    const rightWall = Bodies.rectangle(width-50, height/2, thickness, height, {
      isStatic: true,
      render: { fillStyle: '#555' }
    });
    const floor = Bodies.rectangle(width/2, height-20, width-60, thickness, {
      isStatic: true,
      render: { fillStyle: '#666' },
      restitution: 0.2 // 床の弾み具合
    });

    // 斜めの棒（途中に1本置く）
    // 中央より少し下、角度 -30度くらい
    const bar = Bodies.rectangle(width/2, height/2, 200, 15, {
      isStatic: true,
      angle: -Math.PI / 6, // -30度
      render: { fillStyle: '#888' }
    });

    Composite.add(world, [leftWall, rightWall, floor, bar]);

    // 10円玉のプロパティ
    const COIN_RADIUS = 11;  // ピクセル上の見た目の大きさ
    // 実際の物理では、1ピクセル=1cm のようなスケールを決めておくとよいが、
    // ここでは「相対的な動き」を見るため、大きなスケーリングは行わない。
    const COIN_MASS = 0.0055; // 5.5g = 0.0055kg としておく

    function createCoin(x) {
      const coin = Bodies.circle(x, 60, COIN_RADIUS, {
        mass: COIN_MASS,
        restitution: 0.3,  // 弾み具合（0=全く弾まない～1=よく弾む）
        friction: 0.05,
        frictionAir: 0.001, // 空気抵抗
        render: {
          fillStyle: '#cc8844',
          strokeStyle: '#ddbb77',
          lineWidth: 2
        }
      });
      return coin;
    }

    // 初期状態で1枚落としておく
    let coins = [];
    function dropCoin() {
      const x = width / 2 + (Math.random() * 40 - 20); // 少し左右にランダム
      const c = createCoin(x);
      coins.push(c);
      Composite.add(world, c);
    }

    dropCoin();

    // UI イベント
    document.getElementById('drop').addEventListener('click', dropCoin);

    document.getElementById('gravity').addEventListener('input', (e) => {
      const g = parseFloat(e.target.value) || 0;
      engine.world.gravity.y = g;
    });

    document.getElementById('reset').addEventListener('click', () => {
      // コインを全部削除して1枚だけ再度落とす
      coins.forEach(c => Composite.remove(world, c));
      coins = [];
      dropCoin();
    });

    // 画面リサイズに合わせてキャンバスを中央寄せしたい場合は CSS 側で調整してくだ���い。
  </script>
</body>
</html>
